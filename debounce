function debounce(fn, delay = 500) {
  let timeoutId, lastArgs

  function debounceFn(...args) {
    lastArgs = args
    clearTimeout(timeoutId)
    timeoutId = setTimeout(() => {
      timeoutId = null
      fn(...args)
    }, delay)
  }

  debounceFn.cancel = () => {
    clearTimeout(timeoutId)
    timeoutId = null
  }

  debounceFn.flush = () => {
    clearTimeout(timeoutId)
    if (lastArgs) fn(...lastArgs)
  }
  return debounceFn
}
